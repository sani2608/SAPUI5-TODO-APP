sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/m/MessageBox"],function(e,t,o,d){;"use strict";return e.extend("com.sani.todo.controller.Main",{_service:{EditSpath:""},onInit:function(){this._setTodoModel()},_setTodoModel:function(){const e={};e.results=this._getMockTodos();e.InputField="";e.EditInputField="";e.DatePickerField="";e.EditDatePickerField="";e.CompletePanelFlag=true;e.IncompletePanelFlag=true;const o=new t(e);this.getView().setModel(o,"todosModel")},onLIstItemSelectToComplete:function(e){const{oTodosModel:t,iSelectedObjectId:o}=this._getModelAndSelectedItemId(e);let d=t.getProperty("/results");d=d.map(e=>({...e,done:e.done||o===e.id}));t.setProperty("/results",d);this._removeSelections();this._handlePanelVisibility()},onLIstItemSelectToUnComplete:function(e){const{oTodosModel:t,iSelectedObjectId:o}=this._getModelAndSelectedItemId(e);let d=t.getProperty("/results");d=d.map(e=>{if(o===e.id)e.done=false;return e});t.setProperty("/results",d);this._removeSelections();this._handlePanelVisibility()},_handlePanelVisibility:function(){const{aTodos:e}=this._getModelAndData("todosModel");let t=false;let o=false;e.forEach(e=>{if(e.done===true)t=true;else o=true});this.byId("id_incomplete_panel").setExpanded(o);this.byId("id_complete_panel").setExpanded(t)},_removeSelections:function(){this.byId("id_completed_todos_list").removeSelections();this.byId("id_incompleted_todos_list").removeSelections()},_getModelAndSelectedItemId:function(e){const t=e.getParameter("listItem");const o=t.getBindingContext("todosModel");const d=o.getObject();const i=d.id;const n=t.getModel("todosModel");return{oTodosModel:n,iSelectedObjectId:i}},onDeleteTodoButtonPress:function(e){console.log(e);const{oTodosModel:t,aTodos:o}=this._getModelAndData("todosModel");const d=e.getSource().getBindingContext("todosModel");const i=d.getObject().id;const n=o.filter(e=>e.id!==i);t.setProperty("/results",n);this._handlePanelVisibility()},onEditTodoButtonPress:function(e){console.log(e);this._openEditDialog();const t=e.getSource().getBindingContext("todosModel");const{deadline:o,text:d}=t.getObject();this._service.EditSpath=t.getPath();const{oTodosModel:i}=this._getModelAndData("todosModel");i.setProperty("/EditInputField",d);i.setProperty("/EditDatePickerField",o)},_openEditDialog:function(){const e=this.getView();if(!e.byId("editTodoDialog")){const t={onCloseDialog:function(){debugger;e.byId("editTodoDialog").close()}};o.load({id:e.getId(),name:"com.sani.todo.view.EditTodo",controller:this}).then(function(t){e.addDependent(t);t.open()})}else{e.byId("editTodoDialog").open()}},_getModelAndData:function(e){const t=this.getView().getModel(e);const o=t.getProperty("/results");const d=t.getProperty("/");return{oTodosModel:t,aTodos:o,oData:d}},_getMockTodos:function(){const e=[{text:"Get some carrots",id:1,deadline:"27/7/2022",done:false},{text:"Do some magic",id:2,deadline:"22/7/2022",done:false},{text:"Go to the gym and workout",id:3,deadline:"24/7/2022",done:true},{text:"Buy milk",id:4,deadline:"30/7/2022",done:false},{text:"Eat some fruits",id:5,deadline:"29/7/2022",done:true}];return e},onAddTodoButtonPress:function(){const{oTodosModel:e,aTodos:t,oData:{DatePickerField:o,InputField:i}}=this._getModelAndData("todosModel");if(i){const d={id:t.length+1,text:i,deadline:o,done:false};e.setProperty("/results",[...t,d]);e.setProperty("/DatePickerField","");e.setProperty("/InputField","");this._handlePanelVisibility()}else{d.warning("Task cannot be empty")}},onCloseDialog:function(e){const t=e.getParameter("id").includes("id_save_btn");if(t){const{oTodosModel:e,oData:{EditDatePickerField:t,EditInputField:o}}=this._getModelAndData("todosModel");let d=e.getProperty(this._service.EditSpath);e.setProperty(this._service.EditSpath,{...d,deadline:t,text:o})}this.byId("editTodoDialog").close()}})});